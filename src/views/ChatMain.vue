<template>
    <div>
        <div>
            <TopBar ref="topBar" @model-change="modelChange" @plugin-change="pluginChange"></TopBar>
        </div>
        <div class="mx-32 flex flex-col space-y-5 w-auto h-auto items-start justify-start">
            <div id="content-show" class="space-y-2">
                <MessageItem v-for="msg in conversation" :key="msg.id" :message="msg.message" :is_user="msg.isUser"
                    :image="msg.image">
                </MessageItem>
            </div>
            <div v-if="conversation.length == 0">
                <div class="flex flex-col justify-start items-center flex-grow-0 flex-shrink-0 relative gap-10 max-w-full mt-20"
                    style="filter: drop-shadow(0px 4px 4px rgba(0,0,0,0.25));">
                    <div class="flex justify-start items-center flex-grow-0 flex-shrink-0 relative gap-4">
                        <svg width="220" height="64" viewBox="0 0 220 64" fill="none" xmlns="http://www.w3.org/2000/svg"
                            class="flex-grow-0 flex-shrink-0 w-[220px] h-16 relative" preserveAspectRatio="xMidYMid meet">
                            <path
                                d="M60.1455 26.193C60.6966 24.5688 60.9777 22.8683 60.978 21.1565C60.9778 18.3241 60.2085 15.5428 58.7491 13.0985C55.8167 8.09264 50.377 5.00207 44.4898 5.00207C43.33 5.00208 42.1734 5.12222 41.0393 5.36046C39.5139 3.67499 37.6415 2.32578 35.5456 1.4018C33.4497 0.477818 31.1779 4.92611e-05 28.8799 0H28.7767L28.738 0.000223314C21.6076 0.000223314 15.2841 4.51252 13.0921 11.1647C10.8231 11.6204 8.67962 12.5463 6.80505 13.8802C4.93047 15.2142 3.36809 16.9255 2.2225 18.8996C0.767589 21.3586 0.000890296 24.1508 0 26.9938C0.000556015 30.9892 1.51285 34.8423 4.24405 37.807C3.69273 39.4311 3.41156 41.1317 3.41132 42.8435C3.41158 45.6759 4.1809 48.4572 5.6402 50.9015C7.37558 53.8647 10.0257 56.2108 13.2085 57.6015C16.3912 58.9922 19.9421 59.3556 23.3491 58.6393C24.8747 60.3248 26.7473 61.674 28.8433 62.598C30.9394 63.522 33.2113 63.9999 35.5094 64H35.6126L35.6545 63.9998C42.7888 63.9998 49.1103 59.4873 51.3022 52.8291C53.5712 52.3732 55.7147 51.4472 57.5893 50.1132C59.4639 48.7792 61.0263 47.068 62.1721 45.0939C63.6254 42.6371 64.3906 39.8472 64.3902 37.0069C64.3897 33.0115 62.8774 29.1585 60.1462 26.1939L60.1455 26.193ZM35.6167 59.8159H35.5998C32.7451 59.815 29.981 58.8328 27.7882 57.0402C27.9184 56.9714 28.0471 56.8999 28.1741 56.8257L41.1678 49.465C41.4921 49.284 41.7617 49.022 41.9493 48.7057C42.1369 48.3894 42.2358 48.03 42.2359 47.6641V29.6867L47.728 32.7967C47.7568 32.8108 47.7817 32.8316 47.8003 32.8574C47.8189 32.8831 47.8308 32.913 47.8349 32.9444V47.8221C47.8273 54.4367 42.3619 59.8025 35.6167 59.8159ZM9.3411 48.8101C8.26781 46.9901 7.70234 44.9249 7.70162 42.8225C7.70162 42.1368 7.76268 41.4492 7.88161 40.7736C7.97821 40.8303 8.1468 40.9313 8.26778 40.9995L21.2615 48.3601C21.5854 48.5456 21.9538 48.6433 22.3289 48.6432C22.704 48.6431 23.0724 48.5453 23.3963 48.3597L39.2602 39.3764V45.5967L39.2604 45.6074C39.2604 45.6373 39.2533 45.6669 39.2397 45.6937C39.226 45.7205 39.2062 45.7438 39.1818 45.7618L26.0464 53.1995C24.1878 54.2486 22.0811 54.801 19.9366 54.8016C17.7899 54.8013 15.681 54.2475 13.8214 53.1958C11.9617 52.1441 10.4166 50.6314 9.3411 48.8095V48.8101ZM5.92271 20.991C7.34983 18.56 9.60324 16.6986 12.2886 15.7326C12.2886 15.8423 12.2822 16.0367 12.2822 16.1717V30.8932L12.2819 30.9053C12.282 31.2708 12.3807 31.6298 12.568 31.9458C12.7553 32.2619 13.0246 32.5237 13.3484 32.7046L29.2123 41.6865L23.7205 44.7965C23.6934 44.8141 23.6623 44.8247 23.63 44.8276C23.5977 44.8305 23.5651 44.8255 23.5352 44.8131L10.3985 37.3691C8.54138 36.314 6.99967 34.7988 5.92783 32.9753C4.856 31.1518 4.29168 29.0841 4.29144 26.9793C4.29226 24.8778 4.85496 22.8132 5.9234 20.9916L5.92271 20.991ZM51.0459 31.2889L35.182 22.3059L40.6741 19.197C40.7012 19.1795 40.7323 19.1688 40.7646 19.1659C40.7969 19.163 40.8295 19.168 40.8593 19.1805L53.9959 26.6182C55.8545 27.6716 57.3978 29.186 58.471 31.0093C59.5441 32.8326 60.1093 34.9007 60.1097 37.006C60.1097 42.0308 56.9126 46.5271 52.1053 48.2625V33.1008C52.106 33.0952 52.106 33.0894 52.106 33.0838C52.1059 32.7196 52.0078 32.3619 51.8217 32.0467C51.6356 31.7316 51.368 31.4702 51.0459 31.2889ZM56.5123 23.2204C56.3846 23.1437 56.2559 23.0684 56.1263 22.9947L43.1326 15.6338C42.8087 15.4487 42.4404 15.3511 42.0655 15.351C41.6905 15.3511 41.3223 15.4487 40.9983 15.6338L25.1342 24.6171V18.3969L25.1339 18.3861C25.1339 18.3254 25.1633 18.2682 25.2128 18.2317L38.3482 10.8002C40.2062 9.74976 42.3131 9.19675 44.4577 9.19664C51.2115 9.19664 56.6886 14.5681 56.6886 21.1916C56.6883 21.8713 56.6293 22.5498 56.5123 23.2197V23.2204ZM22.1482 34.3069L16.6549 31.1969C16.6261 31.1828 16.6013 31.1619 16.5826 31.1361C16.564 31.1104 16.5521 31.0805 16.5481 31.0492V16.1712C16.5511 9.55124 22.0281 4.18429 28.779 4.18429C31.6382 4.18487 34.407 5.16717 36.6048 6.96072C36.5059 7.01367 36.3335 7.10706 36.2189 7.17521L23.2252 14.5359C22.9009 14.7168 22.6314 14.9786 22.4438 15.2948C22.2562 15.611 22.1574 15.9703 22.1573 16.3361V16.3479L22.1482 34.3069ZM25.1317 27.9986L32.1972 23.9964L39.2627 27.9959V35.9976L32.1972 39.9973L25.1317 35.9976V27.9986Z"
                                fill="#1C1C1C"></path>
                            <path
                                d="M101.133 28.2015H96.8556C96.7336 27.5019 96.5086 26.8821 96.1807 26.3422C95.8528 25.7947 95.4449 25.3308 94.9569 24.9506C94.4688 24.5703 93.9122 24.2852 93.2869 24.0951C92.6693 23.8973 92.0021 23.7985 91.2853 23.7985C90.0118 23.7985 88.8833 24.1179 87.8996 24.7567C86.916 25.3878 86.1458 26.3156 85.5891 27.5399C85.0325 28.7567 84.7542 30.2433 84.7542 32C84.7542 33.7871 85.0325 35.2928 85.5891 36.5171C86.1534 37.7338 86.9236 38.654 87.8996 39.2776C88.8833 39.8935 90.008 40.2015 91.2738 40.2015C91.9754 40.2015 92.6311 40.1103 93.2412 39.9278C93.8588 39.7376 94.4117 39.4601 94.8997 39.0951C95.3953 38.73 95.8109 38.2814 96.1464 37.7491C96.4896 37.2167 96.7259 36.6084 96.8556 35.924L101.133 35.9468C100.973 37.057 100.626 38.0989 100.093 39.0722C99.5664 40.0456 98.8763 40.9049 98.0223 41.6502C97.1682 42.3878 96.1693 42.9658 95.0255 43.384C93.8817 43.7947 92.6121 44 91.2166 44C89.1578 44 87.3201 43.5247 85.7035 42.5741C84.087 41.6236 82.8135 40.251 81.8832 38.4563C80.9529 36.6616 80.4878 34.5095 80.4878 32C80.4878 29.4829 80.9568 27.3308 81.8947 25.5437C82.8326 23.7491 84.1098 22.3764 85.7264 21.4259C87.343 20.4753 89.1731 20 91.2166 20C92.5206 20 93.733 20.1825 94.8539 20.5475C95.9749 20.9125 96.9738 21.4487 97.8507 22.1559C98.7276 22.8555 99.4482 23.7148 100.012 24.7338C100.584 25.7452 100.958 26.9011 101.133 28.2015Z"
                                fill="#1C1C1C"></path>
                            <path
                                d="M108.977 33.4145V43.6806H104.836V20.3194H108.885V29.1369H109.091C109.503 28.1483 110.14 27.3688 111.002 26.7985C111.871 26.2205 112.976 25.9316 114.319 25.9316C115.539 25.9316 116.602 26.1863 117.51 26.6958C118.417 27.2053 119.119 27.9506 119.614 28.9316C120.118 29.9125 120.369 31.1103 120.369 32.5247V43.6806H116.229V33.1635C116.229 31.9848 115.924 31.0684 115.314 30.4144C114.711 29.7529 113.865 29.4221 112.774 29.4221C112.042 29.4221 111.387 29.5817 110.807 29.9011C110.235 30.2129 109.785 30.6654 109.457 31.2586C109.137 31.8517 108.977 32.5703 108.977 33.4145Z"
                                fill="#1C1C1C"></path>
                            <path
                                d="M131.11 43.9886C129.729 43.9886 128.494 43.635 127.404 42.9278C126.313 42.2205 125.452 41.1939 124.819 39.8479C124.186 38.5019 123.869 36.8669 123.869 34.943C123.869 32.9962 124.19 31.3536 124.83 30.0152C125.478 28.6692 126.351 27.654 127.449 26.9696C128.547 26.2776 129.771 25.9316 131.121 25.9316C132.15 25.9316 132.997 26.1065 133.66 26.4563C134.324 26.7985 134.85 27.2129 135.239 27.6996C135.628 28.1787 135.929 28.6312 136.142 29.057H136.314V26.1597H140.466V43.6806H136.394V40.9202H136.142C135.929 41.346 135.62 41.7985 135.216 42.2776C134.812 42.7491 134.278 43.1521 133.614 43.4867C132.951 43.8213 132.116 43.9886 131.11 43.9886ZM132.265 40.6008C133.142 40.6008 133.889 40.365 134.507 39.8935C135.124 39.4144 135.593 38.7491 135.914 37.8973C136.234 37.0456 136.394 36.0532 136.394 34.9202C136.394 33.7871 136.234 32.8023 135.914 31.9658C135.601 31.1293 135.136 30.4791 134.518 30.0152C133.908 29.5513 133.157 29.3194 132.265 29.3194C131.342 29.3194 130.572 29.5589 129.954 30.038C129.337 30.5171 128.872 31.1787 128.559 32.0228C128.246 32.8669 128.09 33.8327 128.09 34.9202C128.09 36.0152 128.246 36.9924 128.559 37.8517C128.879 38.7034 129.348 39.3764 129.966 39.8707C130.591 40.3574 131.357 40.6008 132.265 40.6008Z"
                                fill="#1C1C1C"></path>
                            <path
                                d="M153.651 26.1597V29.3536H143.551V26.1597H153.651ZM146.045 21.962H150.185V38.4106C150.185 38.9658 150.269 39.3916 150.437 39.6882C150.612 39.9772 150.841 40.1749 151.123 40.2814C151.405 40.3878 151.718 40.4411 152.061 40.4411C152.32 40.4411 152.557 40.4221 152.77 40.384C152.991 40.346 153.159 40.3118 153.274 40.2814L153.971 43.5095C153.75 43.5856 153.434 43.6692 153.022 43.7605C152.618 43.8517 152.122 43.9049 151.535 43.9202C150.498 43.9506 149.564 43.7947 148.733 43.4525C147.901 43.1027 147.242 42.5627 146.754 41.8327C146.273 41.1027 146.037 40.1901 146.045 39.0951V21.962Z"
                                fill="#1C1C1C"></path>
                            <path
                                d="M172.99 27.7795C172.799 27.1635 172.536 26.6122 172.201 26.1255C171.873 25.6312 171.476 25.2091 171.011 24.8593C170.553 24.5095 170.027 24.2471 169.433 24.0722C168.838 23.8897 168.19 23.7985 167.488 23.7985C166.23 23.7985 165.109 24.1141 164.125 24.7452C163.142 25.3764 162.368 26.3042 161.803 27.5285C161.247 28.7452 160.968 30.2281 160.968 31.9772C160.968 33.7414 161.247 35.2357 161.803 36.4601C162.36 37.6844 163.134 38.616 164.125 39.2548C165.117 39.8859 166.268 40.2015 167.58 40.2015C168.769 40.2015 169.799 39.9734 170.668 39.5171C171.545 39.0608 172.22 38.4144 172.692 37.5779C173.165 36.7338 173.402 35.7452 173.402 34.6122L174.362 34.7605H168.003V31.4525H177.508V34.2586C177.508 36.2586 177.081 37.9886 176.227 39.4487C175.373 40.9087 174.198 42.0342 172.704 42.8251C171.209 43.6084 169.494 44 167.557 44C165.399 44 163.504 43.5171 161.872 42.5513C160.248 41.5779 158.978 40.1977 158.063 38.4106C157.156 36.616 156.702 34.4867 156.702 32.0228C156.702 30.1369 156.969 28.4525 157.503 26.9696C158.044 25.4867 158.799 24.2281 159.767 23.1939C160.736 22.1521 161.872 21.3612 163.176 20.8213C164.48 20.2738 165.898 20 167.431 20C168.727 20 169.936 20.1901 171.057 20.5703C172.178 20.943 173.173 21.4753 174.042 22.1673C174.919 22.8593 175.64 23.6806 176.204 24.6312C176.768 25.5817 177.138 26.6312 177.313 27.7795H172.99Z"
                                fill="#1C1C1C"></path>
                            <path
                                d="M181.611 43.6806V20.3194H190.396C192.195 20.3194 193.705 20.654 194.925 21.3232C196.153 21.9924 197.079 22.9125 197.704 24.0837C198.337 25.2471 198.654 26.5703 198.654 28.0532C198.654 29.5513 198.337 30.8821 197.704 32.0456C197.072 33.2091 196.137 34.1255 194.902 34.7947C193.667 35.4563 192.146 35.7871 190.338 35.7871H184.516V32.308H189.766C190.819 32.308 191.68 32.1255 192.351 31.7605C193.022 31.3954 193.518 30.8935 193.838 30.2548C194.166 29.616 194.33 28.8821 194.33 28.0532C194.33 27.2243 194.166 26.4943 193.838 25.8631C193.518 25.2319 193.019 24.7414 192.34 24.3916C191.669 24.0342 190.804 23.8555 189.744 23.8555H185.855V43.6806H181.611Z"
                                fill="#1C1C1C"></path>
                            <path d="M201.31 23.8669V20.3194H220V23.8669H212.76V43.6806H208.551V23.8669H201.31Z"
                                fill="#1C1C1C"></path>
                        </svg>
                        <div
                            class="flex justify-start items-center flex-grow-0 flex-shrink-0 relative px-1 py-0.5 rounded bg-[#c6c7f8]">
                            <p class="flex-grow-0 flex-shrink-0 text-xs text-left text-[#1c1c1c]">Plus</p>
                        </div>
                    </div>
                    <div class="flex-grow-0 flex-shrink-0 w-[100px] h-[100px] relative overflow-hidden"></div>
                    <div class="flex justify-start items-start flex-grow-0 flex-shrink-0 w-full gap-10">
                        <div
                            class="flex flex-col justify-center items-center flex-grow-0 flex-shrink-0 w-[280px] py-2 rounded-2xl">
                            <div
                                class="flex justify-center items-center self-stretch flex-grow-0 flex-shrink-0 relative rounded-lg">
                                <svg width="32" height="32" viewBox="0 0 32 32" fill="none"
                                    xmlns="http://www.w3.org/2000/svg" class="flex-grow-0 flex-shrink-0 w-8 h-8 relative"
                                    preserveAspectRatio="xMidYMid meet">
                                    <path
                                        d="M27 10H23V6C23 5.46957 22.7893 4.96086 22.4142 4.58579C22.0391 4.21071 21.5304 4 21 4H5C4.46957 4 3.96086 4.21071 3.58579 4.58579C3.21071 4.96086 3 5.46957 3 6V22C3.00059 22.1881 3.05423 22.3723 3.15478 22.5313C3.25532 22.6903 3.39868 22.8177 3.56839 22.8989C3.7381 22.9801 3.92728 23.0118 4.11418 22.9903C4.30108 22.9689 4.47814 22.8951 4.625 22.7775L9 19.25V23C9 23.5304 9.21071 24.0391 9.58579 24.4142C9.96086 24.7893 10.4696 25 11 25H22.6987L27.375 28.7775C27.5519 28.9206 27.7724 28.9991 28 29C28.2652 29 28.5196 28.8946 28.7071 28.7071C28.8946 28.5196 29 28.2652 29 28V12C29 11.4696 28.7893 10.9609 28.4142 10.5858C28.0391 10.2107 27.5304 10 27 10ZM8.31875 17.2225L5 19.9062V6H21V17H8.9475C8.71863 17 8.4967 17.0786 8.31875 17.2225ZM27 25.9062L23.6812 23.2225C23.5043 23.0794 23.2838 23.0009 23.0562 23H11V19H21C21.5304 19 22.0391 18.7893 22.4142 18.4142C22.7893 18.0391 23 17.5304 23 17V12H27V25.9062Z"
                                        fill="#1C1C1C"></path>
                                </svg>
                            </div>
                            <div
                                class="flex flex-col justify-center items-start flex-grow-0 flex-shrink-0 relative rounded-lg">
                                <p
                                    class="self-stretch flex-grow-0 flex-shrink-0 w-[85px] text-lg font-semibold text-left text-[#1c1c1c]">
                                    Examples
                                </p>
                            </div>
                        </div>
                        <div
                            class="flex flex-col justify-center items-center flex-grow-0 flex-shrink-0 w-[280px] gap-2 py-2 rounded-2xl">
                            <div
                                class="flex justify-center items-center self-stretch flex-grow-0 flex-shrink-0 relative rounded-lg">
                                <svg width="32" height="32" viewBox="0 0 32 32" fill="none"
                                    xmlns="http://www.w3.org/2000/svg" class="flex-grow-0 flex-shrink-0 w-8 h-8 relative"
                                    preserveAspectRatio="xMidYMid meet">
                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                        d="M13.5 6.7631L12.2389 10.1711C11.8844 11.1291 11.1291 11.8844 10.1711 12.2389L6.7631 13.5L10.1711 14.7611C11.1291 15.1156 11.8844 15.8709 12.2389 16.8289L13.5 20.2369L14.7611 16.8289C15.1156 15.8709 15.8709 15.1156 16.8289 14.7611L20.2369 13.5L16.8289 12.2389C15.8709 11.8844 15.1156 11.1291 14.7611 10.1711L13.5 6.7631ZM14.9068 4.80177C14.4236 3.49584 12.5765 3.49584 12.0932 4.80177L10.3632 9.47702C10.2113 9.8876 9.8876 10.2113 9.47702 10.3632L4.80177 12.0932C3.49584 12.5765 3.49584 14.4236 4.80177 14.9068L9.47702 16.6368C9.8876 16.7887 10.2113 17.1124 10.3632 17.523L12.0932 22.1983C12.5765 23.5042 14.4236 23.5042 14.9068 22.1983L16.6368 17.523C16.7887 17.1124 17.1124 16.7887 17.523 16.6368L22.1983 14.9068C23.5042 14.4236 23.5042 12.5765 22.1983 12.0932L17.523 10.3632C17.1124 10.2113 16.7887 9.8876 16.6368 9.47702L14.9068 4.80177Z"
                                        fill="#1C1C1C"></path>
                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                        d="M23.4998 20.3224L23.0405 21.5637C22.7873 22.248 22.2477 22.7875 21.5635 23.0407L20.3221 23.5001L21.5635 23.9594C22.2477 24.2126 22.7873 24.7521 23.0405 25.4364L23.4998 26.6777L23.9591 25.4364C24.2124 24.7521 24.7519 24.2126 25.4362 23.9594L26.6775 23.5001L25.4362 23.0407C24.7519 22.7875 24.2124 22.248 23.9591 21.5637L23.4998 20.3224ZM24.4377 18.5346C24.1155 17.664 22.8841 17.664 22.562 18.5346L21.6337 21.0431C21.5324 21.3169 21.3166 21.5327 21.0429 21.634L18.5343 22.5622C17.6637 22.8844 17.6637 24.1158 18.5343 24.4379L21.0429 25.3662C21.3166 25.4675 21.5324 25.6833 21.6337 25.957L22.562 28.4656C22.8841 29.3362 24.1155 29.3362 24.4377 28.4656L25.3659 25.957C25.4672 25.6833 25.683 25.4675 25.9567 25.3662L28.4653 24.4379C29.3359 24.1158 29.3359 22.8844 28.4653 22.5622L25.9567 21.634C25.683 21.5327 25.4672 21.3169 25.3659 21.0431L24.4377 18.5346Z"
                                        fill="#1C1C1C"></path>
                                </svg>
                            </div>
                            <div
                                class="flex flex-col justify-center items-start flex-grow-0 flex-shrink-0 relative rounded-lg">
                                <p
                                    class="self-stretch flex-grow-0 flex-shrink-0 w-[105px] text-lg font-semibold text-left text-[#1c1c1c]">
                                    Capabilities
                                </p>
                            </div>
                        </div>
                        <div
                            class="flex flex-col justify-center items-center flex-grow-0 flex-shrink-0 w-[280px] gap-2 py-2 rounded-2xl">
                            <div
                                class="flex justify-center items-center self-stretch flex-grow-0 flex-shrink-0 relative rounded-lg">
                                <svg width="32" height="32" viewBox="0 0 32 32" fill="none"
                                    xmlns="http://www.w3.org/2000/svg" class="flex-grow-0 flex-shrink-0 w-8 h-8 relative"
                                    preserveAspectRatio="xMidYMid meet">
                                    <path
                                        d="M26 5H6C5.46957 5 4.96086 5.21071 4.58579 5.58579C4.21071 5.96086 4 6.46957 4 7V14.3462C4 25.5487 13.4775 29.2638 15.375 29.8937C15.7801 30.0324 16.2199 30.0324 16.625 29.8937C18.525 29.2625 28 25.5475 28 14.345V7C28 6.46957 27.7893 5.96086 27.4142 5.58579C27.0391 5.21071 26.5304 5 26 5ZM26 14.3488C26 24.1512 17.7075 27.4263 16 27.9963C14.3088 27.4338 6 24.1613 6 14.3488V7H26V14.3488ZM15 17V12C15 11.7348 15.1054 11.4804 15.2929 11.2929C15.4804 11.1054 15.7348 11 16 11C16.2652 11 16.5196 11.1054 16.7071 11.2929C16.8946 11.4804 17 11.7348 17 12V17C17 17.2652 16.8946 17.5196 16.7071 17.7071C16.5196 17.8946 16.2652 18 16 18C15.7348 18 15.4804 17.8946 15.2929 17.7071C15.1054 17.5196 15 17.2652 15 17ZM14.5 21.5C14.5 21.2033 14.588 20.9133 14.7528 20.6666C14.9176 20.42 15.1519 20.2277 15.426 20.1142C15.7001 20.0007 16.0017 19.9709 16.2926 20.0288C16.5836 20.0867 16.8509 20.2296 17.0607 20.4393C17.2704 20.6491 17.4133 20.9164 17.4712 21.2074C17.5291 21.4983 17.4993 21.7999 17.3858 22.074C17.2723 22.3481 17.08 22.5824 16.8334 22.7472C16.5867 22.912 16.2967 23 16 23C15.6022 23 15.2206 22.842 14.9393 22.5607C14.658 22.2794 14.5 21.8978 14.5 21.5Z"
                                        fill="#1C1C1C"></path>
                                </svg>
                            </div>
                            <div
                                class="flex flex-col justify-center items-start flex-grow-0 flex-shrink-0 relative rounded-lg">
                                <p
                                    class="self-stretch flex-grow-0 flex-shrink-0 w-[98px] text-lg font-semibold text-left text-[#1c1c1c]">
                                    Limitations
                                </p>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<script setup>
import { ref, reactive, nextTick, watch } from 'vue';
import MessageItem from './MessageItem.vue';
import TopBar from './TopBar.vue';
import axios from 'axios';

const conversation = ref([]);
const selectedFile = ref(null);
const userInput = ref(null);
const model = ref("GPT-3.5");
const plugin = ref("");
const sessionId = ref(null);
const emit = defineEmits(['new_session']);

const topBar = ref(null);

const generateUniqueId = () => {
    return '_' + Math.random().toString(36).substr(2, 9);
};

const newChat = (new_messageContainer, question, url_image) => {
    new_messageContainer.value = "";
    let session_Id = null;
    let title = null;
    const eventSource = new EventSource('http://127.0.0.1:5000/reader/new_chat?query=' + question, {
        headers: {
            'Content-Type': 'application/json'
        }
    });
    eventSource.onmessage = async function (event) {
        const data = JSON.parse(event.data);
        if (data.sessionId !== undefined) {
            console.log(data.sessionId);
            sessionId.value = data.sessionId;
            console.log(":" + sessionId.value)
            title = data.title;
            session_Id = data.sessionId;
            emit('new_session', { title, session_Id });
        }
        const result = data.content;
        if (data.type == 1) {
            new_messageContainer.value += result;
            url_image.value = "https://embedprogram.oss-cn-beijing.aliyuncs.com/20240522195304?OSSAccessKeyId=LTAI5tPApu5LM3CCw8iLHzvQ&Expires=1747914792&Signature=uXf5v3%2B%2B%2FD%2Fw%2F3v8rdzasrffu%2FA%3D"

        } else if (data.type == 2) {
            url_image.value = result;
        }
        if (data.isEnd == true) {
            eventSource.close();
        }
        await nextTick();
        const contentShow = document.getElementById('content-show');
        contentShow.scrollTop = contentShow.scrollHeight;
    };
};

const chatResponse = (messageContainer, question, url_image) => {
    messageContainer.value = "";
    const eventSource = new EventSource('http://127.0.0.1:5000/reader/chat?query=' + question, {
        headers: {
            'Content-Type': 'application/json'
        }
    });
    eventSource.onmessage = async function (event) {
        const data = JSON.parse(event.data);
        const result = data.content;
        if (data.type == 1) {
            messageContainer.value += result;

            url_image.value = "https://embedprogram.oss-cn-beijing.aliyuncs.com/20240522195304?OSSAccessKeyId=LTAI5tPApu5LM3CCw8iLHzvQ&Expires=1747914792&Signature=uXf5v3%2B%2B%2FD%2Fw%2F3v8rdzasrffu%2FA%3D"

        } else if (data.type == 2) {
            url_image.value = result;
        }
        if (data.isEnd == true) {
            eventSource.close();
        }
        await nextTick();
        const contentShow = document.getElementById('content-show');
        contentShow.scrollTop = contentShow.scrollHeight;
    };
};

const sendQuestion = async (question) => {
    userInput.value = question;
    const flowMessage = ref("Please wait a moment...");
    const imageUrl = ref(null);
    conversation.value.push({ id: generateUniqueId(), message: question, isUser: true });
    const item = reactive({
        id: generateUniqueId(),
        message: flowMessage,
        isUser: false,
        file: "",
        image: imageUrl,
        is_received: false,
        avatar: "bi bi-robot"
    });
    conversation.value.push(item);
    await nextTick();
    const contentShow = document.getElementById('content-show');
    contentShow.scrollTop = contentShow.scrollHeight;
    if (sessionId.value == null) {
        newChat(flowMessage, question, imageUrl);
    } else {
        chatResponse(flowMessage, question, imageUrl);
    }
};

// watch(sessionId, () => {
//     conversation.value = [];
// });

const addChat = () => {
    sessionId.value = null;
    conversation.value = [];
};

const changeHistory = (propSessionId) => {
    sessionId.value = propSessionId;
    axios.get("http://127.0.0.1:3000/history_list?sessionId=" + sessionId.value).then(
        res => {
            for (let i = 0; i < res.data.data.message_list.length; i++) {
                const item = {};
                item.message = res.data.data.message_list[i].message_block[0].content;
                item.isUser = res.data.data.message_list[i].role;
                const chat_item = reactive(item);
                conversation.value.push(chat_item);
            }
        }
    );
};

const loadFile = async (file) => {
    selectedFile.value = file;
};

const cancelFile = () => {
    selectedFile.value = null;
};

const modelChange = (value) => {
    model.value = value;
};

const pluginChange = (value) => {
    plugin.value = value;
};

defineExpose({
    sendQuestion, addChat, changeHistory, loadFile, cancelFile,
});
</script>

<style scoped></style>
